<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- =================================================================== -->
    <!-- ============== INICIO DE OPTIMIZACIÓN SEO AVANZADA ================ -->
    <!-- =================================================================== -->

    <title data-lang-key="title">Optimizador de Imágenes por Lotes - Comprime Múltiples Imágenes</title>
    
    <!-- Descripción para Motores de Búsqueda (150-160 caracteres) -->
    <meta id="meta-description" name="description" content="Optimiza múltiples imágenes a la vez (por lotes) con nuestra herramienta web gratuita. Usa preajustes, comprime y convierte a JPEG, PNG y WebP. Arrastra y suelta para empezar.">
    
    <!-- Palabras Clave -->
    <meta name="keywords" content="optimizar imagenes por lotes, compresor de imagenes multiple, reducir tamaño imagenes, batch image optimizer, batch image compressor, optimizador de imagen, redimensionar imagen, diseño responsivo, cleanshot, pegar imagen, arrastrar y soltar, convertir imagen, optimizar para web, multi-idioma">
    
    <!-- Autor y Robots -->
    <meta name="author" content="Hitster Ai">
    <meta name="robots" content="index, follow"> 

    <!-- URL Canónica (IMPORTANTE: REEMPLAZA ESTO CON TU URL REAL) -->
    <link rel="canonical" href="https://[TU-DOMINIO-FINAL.COM]">

    <!-- SEO para Múltiples Idiomas en la Misma URL -->
    <link rel="alternate" hreflang="es" href="https://[TU-DOMINIO-FINAL.COM]">
    <link rel="alternate" hreflang="en" href="https://[TU-DOMINIO-FINAL.COM]">
    <link rel="alternate" hreflang="x-default" href="https://[TU-DOMINIO-FINAL.COM]">


    <!-- =================================================================== -->
    <!-- ============ INICIO DE FAVICONS (REEMPLAZA LOS ARCHIVOS) =========== -->
    <!-- =================================================================== -->

    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"> 
    <link rel="manifest" href="/site.webmanifest">

    <!-- =================================================================== -->
    <!-- ======== INICIO DE METAETIQUETAS PARA REDES SOCIALES (OG & TWITTER) ====== -->
    <!-- =================================================================== -->

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Hitster Ai Image Optimizer">
    <meta property="og:url" content="https://[TU-DOMINIO-FINAL.COM]">
    <meta property="og:title" content="Optimizador de Imágenes por Lotes | Hitster Ai">
    <meta property="og:description" content="Ahorra tiempo optimizando múltiples imágenes a la vez. Nuestra herramienta gratuita soporta carga por lotes, preajustes y compresión avanzada.">
    <meta property="og:image" content="https://[TU-DOMINIO-FINAL.COM]/og-image.jpg"> 

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://[TU-DOMINIO-FINAL.COM]">
    <meta name="twitter:title" content="Optimizador de Imágenes por Lotes | Hitster Ai">
    <meta name="twitter:description" content="Ahorra tiempo optimizando múltiples imágenes a la vez. Nuestra herramienta gratuita soporta carga por lotes, preajustes y compresión avanzada.">
    <meta name="twitter:image" content="https://[TU-DOMINIO-FINAL.COM]/twitter-image.jpg"> 

    <!-- =================================================================== -->
    <!-- ======================= FIN DE LA SECCIÓN SEO ===================== -->
    <!-- =================================================================== -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #404040;
            border-radius: 5px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #a3a3a3;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #262626;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #a3a3a3;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid #262626;
        }
        #copy-feedback, #error-feedback {
            transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-neutral-900 text-neutral-300 flex flex-col min-h-screen">

    <!-- Modal de Instrucciones -->
    <div id="instructions-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-neutral-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <header class="flex items-center justify-between p-4 border-b border-neutral-700">
                <h2 class="text-xl font-bold text-white" data-lang-key="instructions_title">Instrucciones de Uso</h2>
                <button id="close-instructions-modal-btn" class="text-neutral-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </header>
            <div class="p-6 overflow-y-auto" data-lang-key="instructions_content"></div>
        </div>
    </div>

    <!-- Modal de Aviso de Privacidad -->
    <div id="privacy-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-neutral-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <header class="flex items-center justify-between p-4 border-b border-neutral-700">
                <h2 class="text-xl font-bold text-white" data-lang-key="privacy_policy_title">Aviso de Privacidad</h2>
                <button id="close-privacy-modal-btn" class="text-neutral-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
            </header>
            <div class="p-6 overflow-y-auto" data-lang-key="privacy_policy_content"></div>
        </div>
    </div>

    <!-- Notificaciones flotantes -->
    <div id="copy-feedback" class="fixed top-20 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 pointer-events-none z-50">
        <span data-lang-key="copied_feedback">¡Copiado al portapapeles!</span>
    </div>
    <div id="error-feedback" class="fixed top-20 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 pointer-events-none z-50">
        <span id="error-message"></span>
    </div>

    <!-- Cabecera Fija -->
    <header class="sticky top-0 z-40 w-full bg-neutral-900/80 backdrop-blur-sm border-b border-neutral-700/50">
        <div class="container mx-auto px-4 sm:px-6 md:px-8">
            <div class="grid grid-cols-3 items-center h-16">
                <div class="col-start-1"></div>
                <div class="col-start-2 flex justify-center">
                    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold whitespace-nowrap bg-gradient-to-r from-neutral-200 to-neutral-400 bg-clip-text text-transparent text-center" data-lang-key="main_header">Optimizador de Capturas</h1>
                </div>
                <div class="col-start-3 flex justify-end">
                    <div class="relative" id="language-dropdown-container">
                        <button id="language-toggle-btn" class="flex items-center space-x-2 px-3 py-1 text-sm rounded-md bg-neutral-800 text-neutral-400 font-semibold hover:bg-neutral-700 transition-colors">
                            <span data-lang-key="language_label">Lenguaje</span>
                            <svg class="w-4 h-4 text-neutral-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                        <div id="language-menu" class="hidden absolute right-0 mt-2 w-32 bg-neutral-800 border border-neutral-700 rounded-md shadow-lg z-50">
                            <a href="#" id="lang-es" class="block px-4 py-2 text-sm text-neutral-300 hover:bg-neutral-700">Español</a>
                            <a href="#" id="lang-en" class="block px-4 py-2 text-sm text-neutral-300 hover:bg-neutral-700">English</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor principal -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 md:p-8">
        <div class="max-w-4xl mx-auto">
            
            <div id="upload-area" class="w-full border-4 border-dashed border-neutral-700 rounded-2xl p-6 md:p-12 text-center cursor-pointer hover:border-neutral-600 transition-colors bg-neutral-800 mt-8">
                <input type="file" id="image-input" class="hidden" accept="image/*" multiple>
                <div class="flex flex-col items-center">
                    <svg class="w-12 h-12 md:w-16 md:h-16 text-neutral-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <p class="text-base sm:text-lg md:text-xl font-medium" data-lang-key="upload_prompt_main">Arrastra y suelta una imagen aquí</p>
                    <p class="text-sm sm:text-base text-neutral-500" data-lang-key="upload_prompt_sub">o haz clic para seleccionar un archivo</p>
                </div>
            </div>

            <div id="editor-container" class="hidden mt-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                    <div id="preview-container" class="md:col-span-2">
                         <!-- Single Image Preview -->
                        <div id="editor-area" class="hidden flex-col items-center justify-center bg-neutral-800 p-4 rounded-2xl h-full">
                             <img id="image-preview" src="#" alt="Previsualización de la imagen a optimizar" class="max-w-full max-h-[60vh] object-contain rounded-lg">
                            <div class="text-center mt-4 w-full">
                                <p id="original-size" class="text-sm text-neutral-400"></p>
                                <p id="new-size" class="text-lg font-semibold text-green-400"></p>
                            </div>
                        </div>
                        <!-- Batch Image Gallery -->
                        <div id="gallery-area" class="hidden max-h-[70vh] overflow-y-auto bg-neutral-800 p-4 rounded-2xl">
                            <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                                <!-- Thumbnails will be injected here -->
                            </div>
                        </div>
                    </div>

                    <div class="bg-neutral-800 p-6 rounded-2xl flex flex-col space-y-4 md:space-y-6 md:col-span-1">
                        <div id="dimensions-control">
                            <label class="block mb-2 font-medium" data-lang-key="dimensions_label">Dimensiones</label>
                            <div class="flex items-center space-x-2">
                                <input type="number" id="width-input" class="w-full bg-neutral-700 border border-neutral-600 rounded-md px-3 py-2 text-center text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ancho">
                                <button id="aspect-lock-btn" class="p-2 rounded-md bg-neutral-600 hover:bg-neutral-500 transition-colors" title="Mantener proporción" aria-label="Bloquear o desbloquear la proporción de aspecto">
                                    <svg id="lock-icon" class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd"></path></svg>
                                    <svg id="unlock-icon" class="w-5 h-5 text-white hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5a3 3 0 10-6 0V9h6zM10 5.5a3 3 0 00-3 3V9h2V8.5a1 1 0 112 0V9h2V8.5a3 3 0 00-3-3z"></path></svg>
                                </button>
                                <input type="number" id="height-input" class="w-full bg-neutral-700 border border-neutral-600 rounded-md px-3 py-2 text-center text-white focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Alto">
                            </div>
                        </div>

                         <div>
                            <h3 class="font-medium mb-3" data-lang-key="presets_label">Preajustes</h3>
                            <div class="grid grid-cols-3 gap-2">
                                <button data-preset="web" class="preset-btn px-4 py-2 text-sm rounded-lg bg-neutral-700 text-neutral-300 font-semibold" data-lang-key="preset_web">Blog/Web</button>
                                <button data-preset="email" class="preset-btn px-4 py-2 text-sm rounded-lg bg-neutral-700 text-neutral-300 font-semibold" data-lang-key="preset_email">Email/Chat</button>
                                <button data-preset="social" class="preset-btn px-4 py-2 text-sm rounded-lg bg-neutral-700 text-neutral-300 font-semibold" data-lang-key="preset_social">Red Social</button>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-medium mb-3" data-lang-key="format_label">Formato de Salida</h3>
                            <div class="grid grid-cols-3 gap-2">
                                <button data-format="jpeg" class="format-btn px-4 py-2 rounded-lg bg-neutral-600 text-white font-semibold">JPEG</button>
                                <button data-format="png" class="format-btn px-4 py-2 rounded-lg bg-neutral-700 text-neutral-300 font-semibold">PNG</button>
                                <button data-format="webp" class="format-btn px-4 py-2 rounded-lg bg-neutral-700 text-neutral-300 font-semibold">WebP</button>
                            </div>
                        </div>

                        <div id="quality-control">
                             <label for="quality" class="block mb-2 font-medium">
                                <span data-lang-key="quality_label">Calidad</span> (<span id="quality-value">80</span>%)
                            </label>
                            <input type="range" id="quality" min="10" max="100" value="80" class="w-full">
                        </div>
                        
                        <div class="flex-grow"></div>

                        <div class="pt-4 border-t border-neutral-700 flex flex-col space-y-3">
                             <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                                <button id="copy-btn" class="w-full sm:w-1/2 bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-neutral-500 disabled:cursor-not-allowed flex items-center justify-center" disabled>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                    <span class="ml-2" data-lang-key="copy_button">Copiar</span>
                                </button>
                                 <button id="download-btn" class="w-full sm:w-1/2 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-neutral-500 disabled:cursor-not-allowed flex items-center justify-center" disabled>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                    <span class="ml-2" data-lang-key="download_button">Descargar</span>
                                </button>
                             </div>
                             <button id="reset-btn" class="w-full bg-neutral-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-neutral-500 transition-colors" data-lang-key="reset_button">Cargar otra imagen</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div class="w-full flex justify-center items-center space-x-4 pb-4">
        <button id="privacy-btn" class="px-3 py-1 text-sm rounded-md bg-neutral-800 text-neutral-400 font-semibold hover:bg-neutral-700 transition-colors" data-lang-key="privacy_policy_title_short">Aviso de Privacidad</button>
        <button id="instructions-btn" class="px-3 py-1 text-sm rounded-md bg-neutral-800 text-neutral-400 font-semibold hover:bg-neutral-700 transition-colors" data-lang-key="instructions_title_short">Instrucciones</button>
    </div>

    <footer class="w-full text-center p-4 text-neutral-500 text-sm">
        <p>
            2026 <span data-lang-key="footer_rights">Todos los derechos reservados para</span>
            <a href="https://studio--hitsterai.us-central1.hosted.app/es" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline">Hitster Ai</a> | 
            <a href="mailto:baez@hitster.page" class="text-blue-400 hover:underline" data-lang-key="footer_contact">Contáctanos</a>
        </p>
    </footer>

    <!-- DATOS ESTRUCTURADOS (SCHEMA.ORG) PARA RICH SNIPPETS -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Optimizador de Imágenes por Lotes",
      "description": "Herramienta web gratuita para optimizar, redimensionar y comprimir múltiples imágenes a la vez (procesamiento por lotes). Soporta preajustes, JPEG, PNG, WebP, arrastrar y soltar, y es totalmente responsiva.",
      "applicationCategory": "MultimediaApplication",
      "operatingSystem": "All",
      "browserRequirements": "Requires HTML5 support",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "screenshot": "https://[TU-DOMINIO-FINAL.COM]/screenshot.jpg",
      "creator": {
        "@type": "Organization",
        "name": "Hitster Ai",
        "url": "https://studio--hitsterai.us-central1.hosted.app/es"
      }
    }
    </script>

    <script>
        const translations = {
            es: {
                title: "Optimizador de Imágenes por Lotes - Comprime Múltiples Imágenes",
                main_header: "Optimizador de Capturas",
                upload_prompt_main: "Arrastra y suelta una imagen aquí",
                upload_prompt_sub: "o haz clic para seleccionar un archivo",
                dimensions_label: "Dimensiones",
                width_placeholder: "Ancho",
                height_placeholder: "Alto",
                presets_label: "Preajustes",
                preset_web: "Blog/Web",
                preset_email: "Email/Chat",
                preset_social: "Red Social",
                format_label: "Formato de Salida",
                quality_label: "Calidad",
                download_button: "Descargar",
                download_all_button: "Descargar todo (.zip)",
                copy_button: "Copiar",
                reset_button: "Cargar otra imagen",
                original_size_label: "Original:",
                new_size_label: "Nuevo:",
                footer_rights: "Todos los derechos reservados para",
                footer_contact: "Contáctanos",
                language_label: "Lenguaje",
                meta_description: "Optimiza múltiples imágenes a la vez (por lotes) con nuestra herramienta web gratuita. Usa preajustes, comprime y convierte a JPEG, PNG y WebP. Arrastra y suelta para empezar.",
                image_preview_alt: "Previsualización de la imagen a optimizar",
                copied_feedback: "¡Copiado al portapapeles!",
                copy_error_feedback: "La copia automática falló. Por favor, usa el botón 'Descargar'.",
                instructions_title: "Instrucciones de Uso",
                privacy_policy_title: "Aviso de Privacidad",
                privacy_policy_title_short: "Aviso de Privacidad",
                instructions_title_short: "Instrucciones",
                instructions_content: `
                    <div class="text-neutral-400 space-y-4 text-justify">
                        <h3 class="text-xl font-semibold text-white">Guía de Usuario: Optimizador de Imágenes</h3>
                        <p>¡Bienvenido! Esta guía te mostrará cómo usar todas las funciones de la aplicación, incluyendo el nuevo procesamiento por lotes, para optimizar tus imágenes de forma rápida y sencilla.</p>

                        <h4 class="text-lg font-semibold text-white pt-2">Paso 1: Cargar tus Imágenes</h4>
                        <p>Puedes cargar una o varias imágenes a la vez:</p>
                        <ul class="list-disc list-inside ml-4 space-y-2">
                            <li><strong>Arrastrar y Soltar:</strong> Arrastra uno o varios archivos de imagen y suéltalos en el área punteada.</li>
                            <li><strong>Seleccionar Archivos:</strong> Haz clic en el área punteada para abrir el explorador de archivos y selecciona una o más imágenes.</li>
                            <li><strong>Pegar desde el Portapapeles (solo una imagen):</strong> Toma una captura de pantalla y pégala directamente en la página con <code>Ctrl+V</code> o <code>Cmd+V</code>.</li>
                        </ul>
                        <p>Si cargas una sola imagen, verás una vista previa grande. Si cargas varias, verás una galería de miniaturas.</p>

                        <h4 class="text-lg font-semibold text-white pt-2">Paso 2: Optimizar tus Imágenes</h4>
                        <p>Todos los ajustes que realices se aplicarán a todas las imágenes cargadas simultáneamente.</p>
                        <p class="font-semibold text-neutral-200 mt-2">Preajustes (Presets):</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Usa los botones de preajustes (Blog/Web, Email/Chat, etc.) para aplicar configuraciones óptimas con un solo clic.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Dimensiones (solo para una imagen):</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Si solo cargaste una imagen, puedes ajustar el ancho (Width) o alto (Height) exacto en píxeles.</li>
                            <li>Haz clic en el ícono del candado para mantener o liberar la proporción.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Formato y Calidad:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Elige entre <strong>JPEG</strong> (fotos), <strong>PNG</strong> (gráficos/transparencias) o <strong>WebP</strong> (formato web moderno).</li>
                            <li>Ajusta el deslizador de <strong>Calidad</strong> para encontrar el balance perfecto entre tamaño y apariencia visual (no aplica para PNG).</li>
                        </ul>
                        <p>Verás el nuevo tamaño del archivo actualizado en tiempo real en cada miniatura o debajo de la vista previa.</p>

                        <h4 class="text-lg font-semibold text-white pt-2">Paso 3: Usar tus Imágenes Optimizadas</h4>
                        <p>Una vez que estés satisfecho, tienes dos opciones:</p>
                        <p class="font-semibold text-neutral-200">Descargar:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Descargar:</strong> Si cargaste una sola imagen, la guardará como un archivo individual.</li>
                            <li><strong>Descargar todo (.zip):</strong> Si cargaste varias imágenes, las empaquetará todas en un único archivo .zip.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Copiar (solo para una imagen):</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Si solo tienes una imagen cargada, puedes hacer clic en "Copiar" para pegarla directamente en otra aplicación.</li>
                        </ul>

                        <h4 class="text-lg font-semibold text-white pt-2">Funciones Adicionales</h4>
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Memoria de Configuración:</strong> La app recuerda tus últimos ajustes de formato y calidad.</li>
                            <li><strong>Cargar otras:</strong> Haz clic en "Cargar otra imagen" para reiniciar el proceso.</li>
                        </ul>
                    </div>
                `,
                privacy_policy_content: `
                    <div class="text-neutral-400 space-y-4 text-justify">
                        <p class="text-sm">Fecha de última actualización: 23 de junio de 2025</p>
                        <p>Bienvenido a Hitster Ai. Tu privacidad es de suma importancia para nosotros. Este Aviso de Privacidad describe cómo recopilamos, utilizamos, protegemos y compartimos tu información personal cuando visitas y utilizas nuestro sitio web y nuestros servicios. Al utilizar Hitster Ai, aceptas las prácticas descritas en este documento.</p>
                        
                        <h3 class="text-lg font-semibold text-white pt-2">1. Identidad y Domicilio del Responsable</h3>
                        <p>Hitster Ai (en adelante, "nosotros", "nuestro"), con domicilio en Avenida Francisco I. Madero 104, Colonia Céspedes, Pachuca de Soto, Hidalgo, C.P. 42090, es el responsable del tratamiento de tus datos personales.</p>
                        <p>Para cualquier asunto relacionado con este aviso, puedes contactarnos a través del correo electrónico: <a href="mailto:baez@hitster.page" class="text-blue-400 hover:underline">baez@hitster.page</a></p>
                        
                        <h3 class="text-lg font-semibold text-white pt-2">2. Datos Personales que Recabamos</h3>
                        <p>Recopilamos diferentes tipos de datos personales para operar y mejorar nuestros servicios:</p>
                        <p><strong>A. Datos que nos proporcionas directamente:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Información de contacto y cuenta: Nombre completo, dirección de correo electrónico, contraseña y otra información que proporciones al registrarte.</li>
                            <li>Información de perfil: Datos adicionales que decidas agregar a tu perfil de usuario.</li>
                            <li>Comunicaciones: Información que nos proporcionas al contactar a nuestro equipo de soporte o al comunicarte con nosotros por cualquier otro medio.</li>
                        </ul>
                        <p><strong>B. Datos que recopilamos automáticamente:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Información de uso: Registramos cómo interactúas con nuestra plataforma, qué funcionalidades utilizas, la frecuencia y duración de tus visitas.</li>
                            <li>Datos del dispositivo y conexión: Dirección IP, tipo y versión del navegador, sistema operativo, identificadores únicos de dispositivo y otra información técnica.</li>
                            <li>Cookies y tecnologías similares: Utilizamos cookies, balizas web y otras tecnologías para recopilar información, mejorar la experiencia del usuario y para fines de análisis. Consulta nuestra sección sobre "Uso de Cookies" para más detalles.</li>
                        </ul>

                        <h3 class="text-lg font-semibold text-white pt-2">3. Finalidades del Tratamiento de Datos</h3>
                        <p>Utilizamos tus datos personales para las siguientes finalidades:</p>
                        <p><strong>A. Finalidades Primarias (necesarias para el servicio):</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Proveer, operar y mantener nuestros servicios de inteligencia artificial.</li>
                            <li>Crear, gestionar y asegurar tu cuenta de usuario.</li>
                            <li>Procesar tus solicitudes, responder a tus preguntas y brindarte soporte técnico.</li>
                            <li>Garantizar la seguridad, prevenir fraudes y hacer cumplir nuestros términos y condiciones.</li>
                            <li>Enviarte comunicaciones transaccionales importantes sobre tu cuenta o cambios en el servicio.</li>
                        </ul>
                        <p><strong>B. Finalidades Secundarias (requieren tu consentimiento):</strong></p>
                         <ul class="list-disc list-inside ml-4">
                            <li>Realizar análisis estadísticos y de comportamiento para mejorar y optimizar nuestros servicios y desarrollar nuevas funcionalidades.</li>
                            <li>Personalizar tu experiencia en nuestra plataforma.</li>
                            <li>Enviarte boletines informativos (newsletters), promociones, ofertas especiales y otras comunicaciones de marketing sobre nuestros productos.</li>
                        </ul>
                        <p>Si no deseas que tus datos sean utilizados para estas finalidades secundarias, puedes manifestarlo enviando un correo a baez@hitster.page.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">4. Transferencia de Datos Personales</h3>
                        <p>No vendemos ni alquilamos tu información personal. Podemos compartir tus datos con terceros únicamente en las siguientes circunstancias:</p>
                         <ul class="list-disc list-inside ml-4">
                            <li>Proveedores de Servicios: Compartimos información con terceros que nos prestan servicios, como proveedores de alojamiento en la nube (ej. AWS, Google Cloud), plataformas de análisis (ej. Google Analytics) y procesadores de pagos. Estos proveedores solo tienen acceso a los datos necesarios para realizar sus funciones y están obligados contractualmente a protegerlos.</li>
                            <li>Cumplimiento de la Ley: Podremos divulgar tu información si así lo exige la ley, una orden judicial o para proteger nuestros derechos, propiedad o seguridad, así como los de nuestros usuarios o el público en general.</li>
                        </ul>

                        <h3 class="text-lg font-semibold text-white pt-2">5. Uso de Cookies y Tecnologías Similares</h3>
                        <p>Utilizamos cookies para mejorar la funcionalidad de nuestro sitio. Las cookies son pequeños archivos de texto que se almacenan en tu dispositivo. Puedes configurar tu navegador para rechazar todas las cookies o para que te avise cuando se envía una. Sin embargo, si no aceptas las cookies, es posible que no puedas utilizar algunas partes de nuestro servicio.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">6. Derechos ARCO (Acceso, Rectificación, Cancelación y Oposición)</h3>
                        <p>Como titular de los datos, tienes derecho a:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Acceder a los datos personales que poseemos sobre ti.</li>
                            <li>Rectificar tus datos si son inexactos o están incompletos.</li>
                            <li>Cancelar tus datos cuando consideres que no se están utilizando conforme a los principios y deberes establecidos.</li>
                            <li>Oponerte al tratamiento de tus datos para fines específicos.</li>
                        </ul>
                        <p>Para ejercer tus Derechos ARCO, envía una solicitud detallada a baez@hitster.page, incluyendo tu nombre completo, copia de una identificación oficial y una descripción clara de tu solicitud. Te responderemos en los plazos que marca la ley.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">7. Revocación del Consentimiento</h3>
                        <p>Puedes revocar el consentimiento que nos hayas otorgado para el tratamiento de tus datos personales en cualquier momento. Ten en cuenta que la revocación no tendrá efectos retroactivos. Para revocar tu consentimiento, envía tu solicitud a baez@hitster.page.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">8. Medidas de Seguridad</h3>
                        <p>Hemos implementado medidas de seguridad administrativas, técnicas y físicas para proteger tus datos personales contra daño, pérdida, alteración, destrucción o el uso, acceso o tratamiento no autorizado.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">9. Cambios a este Aviso de Privacidad</h3>
                        <p>Nos reservamos el derecho de efectuar en cualquier momento modificaciones o actualizaciones al presente aviso de privacidad. Cualquier cambio será notificado a través de nuestro sitio web o mediante comunicación directa a tu correo electrónico. Te recomendamos revisar periódicamente este aviso.</p>
                    </div>
                `,
            },
            en: {
                title: "Batch Image Optimizer - Compress Multiple Images at Once",
                main_header: "Screenshot Optimizer",
                upload_prompt_main: "Drag and drop an image here",
                upload_prompt_sub: "or click to select a file",
                dimensions_label: "Dimensions",
                width_placeholder: "Width",
                height_placeholder: "Height",
                presets_label: "Presets",
                preset_web: "Blog/Web",
                preset_email: "Email/Chat",
                preset_social: "Social Media",
                format_label: "Output Format",
                quality_label: "Quality",
                download_button: "Download",
                download_all_button: "Download all (.zip)",
                copy_button: "Copy",
                reset_button: "Upload another image",
                original_size_label: "Original:",
                new_size_label: "New:",
                footer_rights: "All rights reserved for",
                footer_contact: "Contact us",
                language_label: "Language",
                meta_description: "Instantly optimize images with our responsive web tool. Paste from clipboard, drag and drop, or select files. Resize, compress, and convert to JPEG, PNG, and WebP on any device.",
                image_preview_alt: "Preview of the image to be optimized",
                copied_feedback: "Copied to clipboard!",
                copy_error_feedback: "Automatic copy failed. Please use the 'Download' button.",
                instructions_title: "How to Use",
                privacy_policy_title: "Privacy Policy",
                privacy_policy_title_short: "Privacy Policy",
                instructions_title_short: "Instructions",
                instructions_content: `
                    <div class="text-neutral-400 space-y-4 text-justify">
                        <h3 class="text-xl font-semibold text-white">User Guide: Image Optimizer</h3>
                        <p>Welcome! This guide will show you how to use all the app's features, including the new batch processing, to optimize your images quickly and easily.</p>
                        
                        <h4 class="text-lg font-semibold text-white pt-2">Step 1: Upload Your Images</h4>
                        <p>You can upload one or multiple images at once:</p>
                        <ul class="list-disc list-inside ml-4 space-y-2">
                            <li><strong>Drag and Drop:</strong> Drag one or more image files and drop them onto the dashed area.</li>
                            <li><strong>Select Files:</strong> Click the dashed area to open your file browser and select one or more images.</li>
                            <li><strong>Paste from Clipboard (single image only):</strong> Take a screenshot and paste it directly onto the page with <code>Ctrl+V</code> or <code>Cmd+V</code>.</li>
                        </ul>
                        <p>If you upload a single image, you'll see a large preview. If you upload multiple, you'll see a thumbnail gallery.</p>
                        
                        <h4 class="text-lg font-semibold text-white pt-2">Step 2: Optimize Your Images</h4>
                        <p>All adjustments you make will apply to all loaded images simultaneously.</p>
                        <p class="font-semibold text-neutral-200 mt-2">Presets:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Use the preset buttons (Blog/Web, Email/Chat, etc.) to apply optimal settings with a single click.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Dimensions (single image only):</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>If you only uploaded one image, you can adjust the exact width or height in pixels.</li>
                            <li>Click the lock icon to maintain or release the aspect ratio.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Format & Quality:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Choose between <strong>JPEG</strong> (photos), <strong>PNG</strong> (graphics/transparency), or <strong>WebP</strong> (modern web format).</li>
                            <li>Adjust the <strong>Quality</strong> slider to find the perfect balance between file size and visual appearance (not applicable for PNG).</li>
                        </ul>
                        <p>You will see the new file size update in real-time on each thumbnail or below the preview.</p>

                        <h4 class="text-lg font-semibold text-white pt-2">Step 3: Use Your Optimized Images</h4>
                        <p>Once you are satisfied with the result, you have two options:</p>
                        <p class="font-semibold text-neutral-200">Download:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Download:</strong> If you uploaded a single image, it will be saved as an individual file.</li>
                            <li><strong>Download all (.zip):</strong> If you uploaded multiple images, it will package them all into a single .zip file.</li>
                        </ul>
                        <p class="font-semibold text-neutral-200 mt-2">Copy (single image only):</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>If you only have one image loaded, you can click "Copy" to paste it directly into another application.</li>
                        </ul>

                        <h4 class="text-lg font-semibold text-white pt-2">Additional Features</h4>
                        <ul class="list-disc list-inside ml-4">
                            <li><strong>Settings Memory:</strong> The app remembers your last format and quality settings.</li>
                            <li><strong>Upload More:</strong> Click "Cargar otra imagen" (Upload another image) to reset the process.</li>
                        </ul>
                    </div>
                `,
                privacy_policy_content: `
                    <div class="text-neutral-400 space-y-4 text-justify">
                        <p class="text-sm">Last updated: June 23, 2025</p>
                        <p>Welcome to Hitster Ai. Your privacy is of the utmost importance to us. This Privacy Notice describes how we collect, use, protect, and share your personal information when you visit and use our website and services. By using Hitster Ai, you agree to the practices described in this document.</p>
                        
                        <h3 class="text-lg font-semibold text-white pt-2">1. Identity and Address of the Controller</h3>
                        <p>Hitster Ai (hereinafter, "we", "us", "our"), with address at Avenida Francisco I. Madero 104, Colonia Céspedes, Pachuca de Soto, Hidalgo, C.P. 42090, is the controller of your personal data.</p>
                        <p>For any matter related to this notice, you can contact us via email: <a href="mailto:baez@hitster.page" class="text-blue-400 hover:underline">baez@hitster.page</a></p>
                        
                        <h3 class="text-lg font-semibold text-white pt-2">2. Personal Data We Collect</h3>
                        <p>We collect different types of personal data to operate and improve our services:</p>
                        <p><strong>A. Data you provide directly to us:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Contact and account information: Full name, email address, password, and other information you provide when you register.</li>
                            <li>Profile information: Additional data you choose to add to your user profile.</li>
                            <li>Communications: Information you provide when contacting our support team or communicating with us by any other means.</li>
                        </ul>
                        <p><strong>B. Data we collect automatically:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Usage information: We record how you interact with our platform, what features you use, the frequency and duration of your visits.</li>
                            <li>Device and connection data: IP address, browser type and version, operating system, unique device identifiers, and other technical information.</li>
                            <li>Cookies and similar technologies: We use cookies, web beacons, and other technologies to collect information, improve the user experience, and for analysis purposes. See our "Use of Cookies" section for more details.</li>
                        </ul>

                        <h3 class="text-lg font-semibold text-white pt-2">3. Purposes of Data Processing</h3>
                        <p>We use your personal data for the following purposes:</p>
                        <p><strong>A. Primary Purposes (necessary for the service):</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>To provide, operate, and maintain our artificial intelligence services.</li>
                            <li>To create, manage, and secure your user account.</li>
                            <li>To process your requests, answer your questions, and provide you with technical support.</li>
                            <li>To ensure security, prevent fraud, and enforce our terms and conditions.</li>
                            <li>To send you important transactional communications about your account or changes to the service.</li>
                        </ul>
                        <p><strong>B. Secondary Purposes (require your consent):</strong></p>
                         <ul class="list-disc list-inside ml-4">
                            <li>To perform statistical and behavioral analysis to improve and optimize our services and develop new features.</li>
                            <li>To personalize your experience on our platform.</li>
                            <li>To send you newsletters, promotions, special offers, and other marketing communications about our products.</li>
                        </ul>
                        <p>If you do not want your data to be used for these secondary purposes, you can state this by sending an email to baez@hitster.page.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">4. Transfer of Personal Data</h3>
                        <p>We do not sell or rent your personal information. We may share your data with third parties only in the following circumstances:</p>
                         <ul class="list-disc list-inside ml-4">
                            <li>Service Providers: We share information with third parties who provide services to us, such as cloud hosting providers (e.g., AWS, Google Cloud), analytics platforms (e.g., Google Analytics), and payment processors. These providers only have access to the data necessary to perform their functions and are contractually obligated to protect it.</li>
                            <li>Compliance with the Law: We may disclose your information if required by law, a court order, or to protect our rights, property, or safety, as well as those of our users or the general public.</li>
                        </ul>

                        <h3 class="text-lg font-semibold text-white pt-2">5. Use of Cookies and Similar Technologies</h3>
                        <p>We use cookies to improve the functionality of our site. Cookies are small text files that are stored on your device. You can set your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some parts of our service.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">6. ARCO Rights (Access, Rectification, Cancellation, and Opposition)</h3>
                        <p>As the data subject, you have the right to:</p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Access the personal data we hold about you.</li>
                            <li>Rectify your data if it is inaccurate or incomplete.</li>
                            <li>Cancel your data when you consider that it is not being used in accordance with the established principles and duties.</li>
                            <li>Object to the processing of your data for specific purposes.</li>
                        </ul>
                        <p>To exercise your ARCO Rights, send a detailed request to baez@hitster.page, including your full name, a copy of an official ID, and a clear description of your request. We will respond within the time limits established by law.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">7. Revocation of Consent</h3>
                        <p>You may revoke the consent you have given us for the processing of your personal data at any time. Please note that the revocation will not have retroactive effects. To revoke your consent, send your request to baez@hitster.page.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">8. Security Measures</h3>
                        <p>We have implemented administrative, technical, and physical security measures to protect your personal data against damage, loss, alteration, destruction, or unauthorized use, access, or processing.</p>

                        <h3 class="text-lg font-semibold text-white pt-2">9. Changes to this Privacy Notice</h3>
                        <p>We reserve the right to make changes or updates to this privacy notice at any time. Any changes will be notified through our website or by direct communication to your email. We recommend that you review this notice periodically.</p>
                    </div>
                `,
            }
        };

        let currentLang = null; 
        let loadedImages = [];
        let isBatchMode = false;
        let originalImage = null; // Used for single image mode
        let originalFileName = ''; // Used for single image mode
        let originalFileSize = 0; // Used for single image mode
        let outputFormat = 'jpeg';
        let aspectRatioLocked = true;
        
        const setLanguage = (lang) => {
            if (lang === currentLang) return; 
            currentLang = lang;
            document.documentElement.lang = lang;

            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[lang][key];
                if (translation === undefined) return;

                if (key === 'title') {
                    document.title = translation;
                } else if (key.endsWith('_content')) {
                    element.innerHTML = translation;
                } else {
                     const icon = element.querySelector('svg');
                    if (icon) {
                        const textNode = document.createTextNode(` ${translation}`);
                        Array.from(element.childNodes).forEach(child => {
                            if(child.nodeType === Node.TEXT_NODE) element.removeChild(child);
                        });
                        element.appendChild(textNode);
                    } else {
                        element.textContent = translation;
                    }
                }
            });

            document.getElementById('meta-description').setAttribute('content', translations[lang].meta_description);
            if (!isBatchMode) document.getElementById('image-preview').setAttribute('alt', translations[lang].image_preview_alt);
            document.getElementById('width-input').setAttribute('placeholder', translations[lang].width_placeholder);
            document.getElementById('height-input').setAttribute('placeholder', translations[lang].height_placeholder);
            
            document.getElementById('lang-es').classList.toggle('bg-neutral-700', lang === 'es');
            document.getElementById('lang-en').classList.toggle('bg-neutral-700', lang === 'en');
            
            if(originalImage || isBatchMode) updateAllDisplays();
        };

        const formatBytes = (bytes, decimals = 2) => {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        };

        const handleFiles = (files) => {
            if (files.length === 0) return;
            
            if (files.length === 1) {
                isBatchMode = false;
                handleSingleFile(files[0]);
            } else {
                isBatchMode = true;
                handleMultipleFiles(Array.from(files));
            }
        };

        const handleSingleFile = (file) => {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        const { uploadArea, editorContainer, editorArea, galleryArea, imagePreview, widthInput, heightInput, downloadBtn, copyBtn, dimensionsControl } = getDOMElements();
                        
                        imagePreview.src = e.target.result;
                        widthInput.value = originalImage.width;
                        heightInput.value = originalImage.height;
                        
                        uploadArea.classList.add('hidden');
                        editorContainer.classList.remove('hidden');
                        editorArea.style.display = 'flex';
                        galleryArea.style.display = 'none';
                        dimensionsControl.style.display = 'block';

                        originalFileName = file.name || 'image.png';
                        originalFileSize = file.size;
                        
                        copyBtn.disabled = false;
                        downloadBtn.disabled = false;

                        updateAllDisplays();
                    };
                    originalImage.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
        
        const handleMultipleFiles = (files) => {
            loadedImages = [];
            const { uploadArea, editorContainer, editorArea, galleryArea, galleryGrid, downloadBtn, copyBtn, dimensionsControl } = getDOMElements();

            galleryGrid.innerHTML = ''; // Clear previous thumbnails
            
            let filesLoaded = 0;
            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            loadedImages[index] = {
                                originalFile: file,
                                image: img,
                                newSize: 0
                            };
                            
                            const thumb = createThumbnail(img, file, index);
                            galleryGrid.appendChild(thumb);

                            filesLoaded++;
                            if (filesLoaded === files.length) {
                                updateAllDisplays();
                            }
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            uploadArea.classList.add('hidden');
            editorContainer.classList.remove('hidden');
            editorArea.style.display = 'none';
            galleryArea.style.display = 'block';
            dimensionsControl.style.display = 'none';
            
            copyBtn.disabled = true; // Disable copy in batch mode
            downloadBtn.disabled = false;
        };
        
        const createThumbnail = (img, file, index) => {
            const thumbDiv = document.createElement('div');
            thumbDiv.className = 'relative group';
            thumbDiv.dataset.index = index;

            const imgElement = document.createElement('img');
            imgElement.src = img.src;
            imgElement.className = 'w-full h-24 object-cover rounded-md';

            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center justify-center p-1 rounded-md text-xs';

            const originalSizeP = document.createElement('p');
            originalSizeP.className = 'text-neutral-400';
            originalSizeP.textContent = `${translations[currentLang].original_size_label} ${formatBytes(file.size)}`;

            const newSizeP = document.createElement('p');
            newSizeP.className = 'text-green-400 font-semibold';
            newSizeP.id = `new-size-${index}`;
            newSizeP.textContent = `${translations[currentLang].new_size_label} ...`;

            overlay.appendChild(originalSizeP);
            overlay.appendChild(newSizeP);
            thumbDiv.appendChild(imgElement);
            thumbDiv.appendChild(overlay);

            return thumbDiv;
        };

        const updateAllDisplays = () => {
            const { downloadBtn } = getDOMElements();
            if (isBatchMode) {
                downloadBtn.querySelector('span').textContent = translations[currentLang].download_all_button;
                processBatchImages();
            } else {
                downloadBtn.querySelector('span').textContent = translations[currentLang].download_button;
                processSingleImage();
            }
        };

        const processSingleImage = () => {
            if (!originalImage) return;
            const { widthInput, heightInput, qualitySlider } = getDOMElements();
            
            let newWidth = parseInt(widthInput.value);
            let newHeight = parseInt(heightInput.value);
            const quality = parseInt(qualitySlider.value) / 100;
            
            if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) return;

            const canvas = document.createElement('canvas');
            canvas.width = newWidth;
            canvas.height = newHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(originalImage, 0, 0, newWidth, newHeight);

            canvas.toBlob((blob) => {
                if(blob) {
                    const { originalSizeDisplay, newSizeDisplay } = getDOMElements();
                    originalSizeDisplay.textContent = `${translations[currentLang].original_size_label} ${formatBytes(originalFileSize)}`;
                    newSizeDisplay.textContent = `${translations[currentLang].new_size_label} ${formatBytes(blob.size)}`;
                }
            }, `image/${outputFormat}`, quality);
        };
        
        const processBatchImages = async () => {
             for(let i = 0; i < loadedImages.length; i++) {
                const item = loadedImages[i];
                if(item) {
                     const blob = await getOptimizedBlob(item.image, { usePresets: true });
                     if (blob) {
                         item.newSize = blob.size;
                         const newSizeDisplay = document.getElementById(`new-size-${i}`);
                         if(newSizeDisplay) newSizeDisplay.textContent = `${translations[currentLang].new_size_label} ${formatBytes(blob.size)}`;
                     }
                }
             }
        };

        const getOptimizedBlob = (image, options = {}) => {
            return new Promise((resolve) => {
                const { qualitySlider, widthInput, heightInput } = getDOMElements();
                const quality = parseInt(qualitySlider.value) / 100;
                let newWidth, newHeight;

                if (options.usePresets) {
                    // For batch mode, we rely on presets which might define maxWidth or scale
                    const activePreset = document.querySelector('.preset-btn.bg-neutral-600');
                    if (activePreset) {
                        const presetName = activePreset.dataset.preset;
                        const presets = {
                            web: { format: 'webp', quality: 80, maxWidth: 1200 },
                            email: { format: 'jpeg', quality: 70, scale: 0.5 },
                            social: { format: 'jpeg', quality: 85, maxWidth: 1080 }
                        };
                        const config = presets[presetName];
                        if (config.maxWidth && image.width > config.maxWidth) {
                            newWidth = config.maxWidth;
                            newHeight = Math.round(config.maxWidth / (image.width / image.height));
                        } else if (config.scale) {
                            newWidth = Math.round(image.width * config.scale);
                            newHeight = Math.round(image.height * config.scale);
                        }
                    }
                }
                
                // Fallback to original dimensions if no preset logic applied
                if (!newWidth || !newHeight) {
                    newWidth = options.usePresets ? image.width : parseInt(widthInput.value);
                    newHeight = options.usePresets ? image.height : parseInt(heightInput.value);
                }
                
                if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) return resolve(null);
                
                const canvas = document.createElement('canvas');
                canvas.width = newWidth;
                canvas.height = newHeight;
                canvas.getContext('2d').drawImage(image, 0, 0, newWidth, newHeight);
                canvas.toBlob((blob) => { resolve(blob); }, `image/${outputFormat}`, quality);
            });
        };
        
        const showCopyFeedback = () => {
            const { copyFeedback } = getDOMElements();
            copyFeedback.classList.remove('opacity-0');
            setTimeout(() => { copyFeedback.classList.add('opacity-0'); }, 2000);
        };
        
        const showErrorFeedback = (message) => {
            const { errorFeedback, errorMessage } = getDOMElements();
            errorMessage.textContent = message;
            errorFeedback.classList.remove('opacity-0');
            setTimeout(() => { errorFeedback.classList.add('opacity-0'); }, 3000);
        };
        
        function getDOMElements() {
            return {
                uploadArea: document.getElementById('upload-area'),
                imageInput: document.getElementById('image-input'),
                editorContainer: document.getElementById('editor-container'),
                editorArea: document.getElementById('editor-area'),
                galleryArea: document.getElementById('gallery-area'),
                galleryGrid: document.getElementById('gallery-grid'),
                imagePreview: document.getElementById('image-preview'),
                widthInput: document.getElementById('width-input'),
                heightInput: document.getElementById('height-input'),
                dimensionsControl: document.getElementById('dimensions-control'),
                aspectLockBtn: document.getElementById('aspect-lock-btn'),
                lockIcon: document.getElementById('lock-icon'),
                unlockIcon: document.getElementById('unlock-icon'),
                formatButtons: document.querySelectorAll('.format-btn'),
                presetButtons: document.querySelectorAll('.preset-btn'),
                qualityControl: document.getElementById('quality-control'),
                qualitySlider: document.getElementById('quality'),
                qualityValue: document.getElementById('quality-value'),
                downloadBtn: document.getElementById('download-btn'),
                copyBtn: document.getElementById('copy-btn'),
                resetBtn: document.getElementById('reset-btn'),
                originalSizeDisplay: document.getElementById('original-size'),
                newSizeDisplay: document.getElementById('new-size'),
                copyFeedback: document.getElementById('copy-feedback'),
                errorFeedback: document.getElementById('error-feedback'),
                errorMessage: document.getElementById('error-message'),
                instructionsBtns: document.querySelectorAll('#instructions-btn'),
                privacyBtns: document.querySelectorAll('#privacy-btn'),
                instructionsModal: document.getElementById('instructions-modal'),
                closeInstructionsModalBtn: document.getElementById('close-instructions-modal-btn'),
                privacyModal: document.getElementById('privacy-modal'),
                closePrivacyModalBtn: document.getElementById('close-privacy-modal-btn'),
                languageToggleBtn: document.getElementById('language-toggle-btn'),
                languageMenu: document.getElementById('language-menu'),
                languageDropdownContainer: document.getElementById('language-dropdown-container'),
            };
        }

        function setupEventListeners() {
            const elements = getDOMElements();

            document.getElementById('lang-es').addEventListener('click', (e) => { e.preventDefault(); setLanguage('es'); elements.languageMenu.classList.add('hidden'); });
            document.getElementById('lang-en').addEventListener('click', (e) => { e.preventDefault(); setLanguage('en'); elements.languageMenu.classList.add('hidden'); });

            elements.languageToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); elements.languageMenu.classList.toggle('hidden'); });
            document.addEventListener('click', (e) => { if (elements.languageDropdownContainer && !elements.languageDropdownContainer.contains(e.target)) { elements.languageMenu.classList.add('hidden'); } });
            
            elements.uploadArea.addEventListener('click', () => elements.imageInput.click());
            elements.uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); elements.uploadArea.classList.add('border-blue-500'); });
            elements.uploadArea.addEventListener('dragleave', () => { elements.uploadArea.classList.remove('border-blue-500'); });
            elements.uploadArea.addEventListener('drop', (e) => { e.preventDefault(); elements.uploadArea.classList.remove('border-blue-500'); handleFiles(e.dataTransfer.files); });
            elements.imageInput.addEventListener('change', (e) => handleFiles(e.target.files));
            
            document.addEventListener('paste', (e) => {
                const items = (e.clipboardData || window.clipboardData).items;
                if (!items) return;
                const imageFile = Array.from(items).find(item => item.type.indexOf('image') !== -1)?.getAsFile();
                if (imageFile && !getDOMElements().uploadArea.classList.contains('hidden')) {
                     e.preventDefault();
                     handleFiles([imageFile]);
                }
            });

            elements.widthInput.addEventListener('input', () => {
                if (aspectRatioLocked && originalImage) {
                    const newWidth = parseInt(elements.widthInput.value);
                    const originalAspectRatio = originalImage.width / originalImage.height;
                    if (!isNaN(newWidth) && newWidth > 0) elements.heightInput.value = Math.round(newWidth / originalAspectRatio);
                }
                processSingleImage();
            });

            elements.heightInput.addEventListener('input', () => {
                if (aspectRatioLocked && originalImage) {
                    const newHeight = parseInt(elements.heightInput.value);
                    const originalAspectRatio = originalImage.width / originalImage.height;
                    if (!isNaN(newHeight) && newHeight > 0) elements.widthInput.value = Math.round(newHeight * originalAspectRatio);
                }
                processSingleImage();
            });
            
            elements.aspectLockBtn.addEventListener('click', () => {
                aspectRatioLocked = !aspectRatioLocked;
                elements.lockIcon.classList.toggle('hidden', !aspectRatioLocked);
                elements.unlockIcon.classList.toggle('hidden', aspectRatioLocked);
                localStorage.setItem('aspectRatioLocked', aspectRatioLocked);
            });

            elements.qualitySlider.addEventListener('input', (e) => {
                elements.qualityValue.textContent = e.target.value;
                updateAllDisplays();
                localStorage.setItem('quality', e.target.value);
            });

            elements.formatButtons.forEach(button => {
                button.addEventListener('click', () => {
                    outputFormat = button.dataset.format;
                    elements.formatButtons.forEach(btn => btn.classList.replace('bg-neutral-600', 'bg-neutral-700'));
                    button.classList.replace('bg-neutral-700', 'bg-neutral-600');
                    elements.qualityControl.style.display = (outputFormat === 'png') ? 'none' : 'block';
                    updateAllDisplays();
                    localStorage.setItem('outputFormat', outputFormat);
                });
            });
            
            elements.downloadBtn.addEventListener('click', async () => {
                if (isBatchMode) {
                    const zip = new JSZip();
                    for (const item of loadedImages) {
                        if (item) {
                            const blob = await getOptimizedBlob(item.image, { usePresets: true });
                            const baseName = item.originalFile.name.substring(0, item.originalFile.name.lastIndexOf('.'));
                            zip.file(`${baseName}-optimized.${outputFormat}`, blob);
                        }
                    }
                    zip.generateAsync({type:"blob"}).then(function(content) {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(content);
                        link.download = "optimized-images.zip";
                        link.click();
                        URL.revokeObjectURL(link.href);
                    });
                } else {
                    const blob = await getOptimizedBlob(originalImage);
                    if (blob) {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        const baseName = originalFileName.substring(0, originalFileName.lastIndexOf('.'));
                        link.download = `${baseName}-optimized.${outputFormat}`;
                        link.href = url;
                        link.click();
                        URL.revokeObjectURL(url);
                    }
                }
            });
            
            elements.copyBtn.addEventListener('click', async () => {
                const blob = await getOptimizedBlob(originalImage);
                if (!blob) return;

                if (navigator.clipboard && navigator.clipboard.write) {
                    try {
                        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
                        showCopyFeedback();
                        return; 
                    } catch (err) {
                        console.warn('Modern clipboard API failed. Trying fallback.', err);
                    }
                }
                
                try {
                    const reader = new FileReader();
                    reader.onload = function() {
                        const dataUrl = reader.result;
                        const tempDiv = document.createElement('div');
                        tempDiv.contentEditable = true;
                        tempDiv.style.position = 'absolute';
                        tempDiv.style.left = '-9999px';

                        const img = document.createElement('img');
                        img.src = dataUrl;
                        tempDiv.appendChild(img);
                        document.body.appendChild(tempDiv);

                        const range = document.createRange();
                        range.selectNodeContents(tempDiv);
                        
                        const selection = window.getSelection();
                        selection.removeAllRanges();
                        selection.addRange(range);

                        const success = document.execCommand('copy');
                        
                        document.body.removeChild(tempDiv);
                        selection.removeAllRanges();

                        if (success) {
                            showCopyFeedback();
                        } else {
                            throw new Error('document.execCommand("copy") returned false.');
                        }
                    };
                    reader.onerror = function() {
                         throw new Error('FileReader failed to read the blob for fallback copy.');
                    };
                    reader.readAsDataURL(blob);
                } catch(err) {
                    console.error('Fallback copy method failed:', err);
                    const errorMsg = translations[currentLang].copy_error_feedback;
                    showErrorFeedback(errorMsg);
                }
            });

            elements.resetBtn.addEventListener('click', () => {
                const { uploadArea, editorContainer, imageInput, downloadBtn, copyBtn, widthInput, heightInput } = getDOMElements();

                originalImage = null;
                loadedImages = [];
                isBatchMode = false;
                imageInput.value = '';
                editorContainer.classList.add('hidden');
                uploadArea.classList.remove('hidden');
                downloadBtn.disabled = true;
                copyBtn.disabled = true;
                widthInput.value = '';
                heightInput.value = '';
                loadSettings(); 
            });

            elements.instructionsBtns.forEach(btn => btn.addEventListener('click', () => { elements.instructionsModal.classList.remove('hidden'); }));
            elements.closeInstructionsModalBtn.addEventListener('click', () => { elements.instructionsModal.classList.add('hidden'); });
            elements.instructionsModal.addEventListener('click', (e) => { if (e.target === elements.instructionsModal) elements.instructionsModal.classList.add('hidden'); });
            
            elements.privacyBtns.forEach(btn => btn.addEventListener('click', () => { elements.privacyModal.classList.remove('hidden'); }));
            elements.closePrivacyModalBtn.addEventListener('click', () => { elements.privacyModal.classList.add('hidden'); });
            elements.privacyModal.addEventListener('click', (e) => { if (e.target === elements.privacyModal) elements.privacyModal.classList.add('hidden'); });

            const presets = {
                web: { format: 'webp', quality: 80, maxWidth: 1200 },
                email: { format: 'jpeg', quality: 70, scale: 0.5 },
                social: { format: 'jpeg', quality: 85, maxWidth: 1080 }
            };

            elements.presetButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!originalImage && !isBatchMode) return;
                    
                    elements.presetButtons.forEach(pBtn => pBtn.classList.replace('bg-neutral-600', 'bg-neutral-700'));
                    btn.classList.replace('bg-neutral-700', 'bg-neutral-600');

                    const presetName = btn.dataset.preset;
                    const config = presets[presetName];
                    const { qualitySlider, qualityValue, formatButtons, qualityControl } = getDOMElements();
                    
                    outputFormat = config.format;
                    formatButtons.forEach(fBtn => fBtn.classList.replace('bg-neutral-600', 'bg-neutral-700'));
                    document.querySelector(`button[data-format="${outputFormat}"]`).classList.replace('bg-neutral-700', 'bg-neutral-600');
                    qualityControl.style.display = (outputFormat === 'png') ? 'none' : 'block';
                    localStorage.setItem('outputFormat', outputFormat);

                    qualitySlider.value = config.quality;
                    qualityValue.textContent = config.quality;
                    localStorage.setItem('quality', config.quality);

                    if (!isBatchMode) {
                        const { widthInput, heightInput } = getDOMElements();
                        const originalAspectRatio = originalImage.width / originalImage.height;
                         if (config.maxWidth && originalImage.width > config.maxWidth) {
                            widthInput.value = config.maxWidth;
                            heightInput.value = Math.round(config.maxWidth / originalAspectRatio);
                        } else if (config.scale) {
                            widthInput.value = Math.round(originalImage.width * config.scale);
                            heightInput.value = Math.round(originalImage.height * config.scale);
                        } else {
                            widthInput.value = originalImage.width;
                            heightInput.value = originalImage.height;
                        }
                    }
                    
                    updateAllDisplays();
                });
            });
        }

        function loadSettings() {
            const { qualitySlider, qualityValue, lockIcon, unlockIcon, formatButtons, qualityControl } = getDOMElements();
            
            const savedFormat = localStorage.getItem('outputFormat') || 'jpeg';
            outputFormat = savedFormat;
            formatButtons.forEach(btn => btn.classList.replace('bg-neutral-600', 'bg-neutral-700'));
            document.querySelector(`button[data-format="${savedFormat}"]`).classList.replace('bg-neutral-700', 'bg-neutral-600');
            qualityControl.style.display = (savedFormat === 'png') ? 'none' : 'block';

            const savedQuality = localStorage.getItem('quality') || '80';
            qualitySlider.value = savedQuality;
            qualityValue.textContent = savedQuality;

            const savedLock = localStorage.getItem('aspectRatioLocked');
            aspectRatioLocked = savedLock !== null ? JSON.parse(savedLock) : true;
            lockIcon.classList.toggle('hidden', !aspectRatioLocked);
            unlockIcon.classList.toggle('hidden', aspectRatioLocked);
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadSettings();
            setLanguage('es'); 
        });
    </script>
</body>
</html>

