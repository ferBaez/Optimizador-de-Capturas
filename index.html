<!DOCTYPE html>
<html lang="es" itemscope itemtype="http://schema.org/WebPage">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- =================================================================== -->
    <!-- ==================== SEO & AEO META TAGS ========================== -->
    <!-- =================================================================== -->

    <title data-lang-key="title">Optimizador de Imágenes Gratis v2.0: Comprimir, Convertir a PDF y Redimensionar</title>
    
    <!-- Meta Descripción optimizada para Snippets -->
    <meta id="meta-description" name="description" content="Herramienta web gratuita para optimizar imágenes masivamente. Comprime JPG/PNG/WebP, convierte a PDF y redimensiona sin subir archivos a la nube. Privacidad total y procesamiento local.">
    
    <!-- Palabras Clave (Keywords) incluyendo términos de búsqueda por voz (AEO) -->
    <meta name="keywords" content="optimizador de imagenes gratis, comprimir fotos sin perder calidad, convertir imagenes a pdf, redimensionar imagenes por lotes, limpiar metadatos exif, herramienta web privacidad, cleanshot alternative, batch image optimizer, convert jpg to pdf online private">
    
    <meta name="author" content="Hitster Ai">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <meta name="theme-color" content="#171717">

    <!-- URL Canónica -->
    <link rel="canonical" href="https://[TU-DOMINIO-FINAL.COM]">

    <!-- Hreflang para SEO Internacional -->
    <link rel="alternate" hreflang="es" href="https://[TU-DOMINIO-FINAL.COM]">
    <link rel="alternate" hreflang="en" href="https://[TU-DOMINIO-FINAL.COM]">
    <link rel="alternate" hreflang="x-default" href="https://[TU-DOMINIO-FINAL.COM]">

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png"> 
    <link rel="manifest" href="/site.webmanifest">

    <!-- Open Graph (Facebook/LinkedIn/WhatsApp) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Hitster Ai Image Optimizer">
    <meta property="og:url" content="https://[TU-DOMINIO-FINAL.COM]">
    <meta property="og:title" content="Optimizador de Imágenes v2.0 | Privado y por Lotes">
    <meta property="og:description" content="La forma más segura de comprimir y convertir imágenes. Procesamiento 100% local en tu navegador, sin subir archivos. Prueba el comparador visual.">
    <meta property="og:image" content="https://[TU-DOMINIO-FINAL.COM]/og-image.jpg"> 
    <meta property="og:locale" content="es_ES">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://[TU-DOMINIO-FINAL.COM]">
    <meta name="twitter:title" content="Optimizador de Imágenes v2.0 | Hitster Ai">
    <meta name="twitter:description" content="Comprime, redimensiona y convierte a PDF tus imágenes localmente. Privacidad garantizada.">
    <meta name="twitter:image" content="https://[TU-DOMINIO-FINAL.COM]/twitter-image.jpg"> 

    <!-- Librerías Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
        
        /* Sliders personalizados */
        input[type="range"].custom-range {
            -webkit-appearance: none; appearance: none; width: 100%; height: 6px; background: #404040; border-radius: 9999px; outline: none; cursor: pointer;
        }
        input[type="range"].custom-range::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: #3b82f6; border-radius: 50%; border: 2px solid #171717; transition: transform 0.1s ease;
        }
        input[type="range"].custom-range::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type="range"].custom-range::-moz-range-thumb {
            width: 18px; height: 18px; background: #3b82f6; border-radius: 50%; border: 2px solid #171717; cursor: pointer;
        }

        /* Estilos para el slider de comparación */
        #compare-slider {
            -webkit-appearance: none; appearance: none; background: transparent;
        }
        #compare-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 2px; height: 200px; background: transparent; cursor: col-resize;
        }
        #compare-slider::-moz-range-thumb {
            width: 2px; height: 200px; background: transparent; cursor: col-resize; border: none;
        }

        #copy-feedback, #error-feedback { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
        
        /* Scrollbar personalizada */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #171717; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #404040; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #525252; }
    </style>
</head>
<body class="bg-neutral-950 text-neutral-300 flex flex-col min-h-screen selection:bg-blue-500/30">

    <!-- Modales -->
    <div id="instructions-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" role="dialog" aria-modal="true" aria-labelledby="instructions-title">
        <div class="bg-neutral-900 border border-neutral-700/50 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col">
            <header class="flex items-center justify-between p-5 border-b border-neutral-800">
                <h2 id="instructions-title" class="text-xl font-bold text-white" data-lang-key="instructions_title">Instrucciones</h2>
                <button id="close-instructions-modal-btn" class="text-neutral-400 hover:text-white transition-colors p-1 rounded-md hover:bg-neutral-800" aria-label="Cerrar instrucciones">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div class="p-6 overflow-y-auto custom-scrollbar text-justify" data-lang-key="instructions_content"></div>
        </div>
    </div>
    <div id="privacy-modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50" role="dialog" aria-modal="true" aria-labelledby="privacy-title">
        <div class="bg-neutral-900 border border-neutral-700/50 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[85vh] flex flex-col">
            <header class="flex items-center justify-between p-5 border-b border-neutral-800">
                <h2 id="privacy-title" class="text-xl font-bold text-white" data-lang-key="privacy_policy_title">Privacidad</h2>
                <button id="close-privacy-modal-btn" class="text-neutral-400 hover:text-white transition-colors p-1 rounded-md hover:bg-neutral-800" aria-label="Cerrar privacidad">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div class="p-6 overflow-y-auto custom-scrollbar text-justify" data-lang-key="privacy_policy_content"></div>
        </div>
    </div>

    <!-- Notificaciones -->
    <div id="copy-feedback" class="fixed top-24 right-5 bg-emerald-600 text-white py-3 px-5 rounded-lg shadow-lg shadow-emerald-900/20 opacity-0 pointer-events-none z-50 transform translate-y-2 font-medium flex items-center gap-2" role="alert">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        <span data-lang-key="copied_feedback">¡Copiado!</span>
    </div>
    <div id="error-feedback" class="fixed top-24 right-5 bg-red-600 text-white py-3 px-5 rounded-lg shadow-lg shadow-red-900/20 opacity-0 pointer-events-none z-50 transform translate-y-2 font-medium flex items-center gap-2" role="alert">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span id="error-message"></span>
    </div>

    <!-- Header -->
    <header class="sticky top-0 z-40 w-full bg-neutral-950/80 backdrop-blur-md border-b border-neutral-800">
        <div class="container mx-auto px-4 sm:px-6 md:px-8">
            <div class="grid grid-cols-3 items-center h-16">
                <div class="col-start-1 flex items-center">
                    <span class="text-xs font-bold text-blue-500 bg-blue-500/10 px-2 py-1 rounded border border-blue-500/20 tracking-wide">v2.0</span>
                </div>
                <div class="col-start-2 flex justify-center">
                    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold whitespace-nowrap bg-gradient-to-br from-white via-neutral-200 to-neutral-500 bg-clip-text text-transparent text-center tracking-tight" data-lang-key="main_header">Optimizador</h1>
                </div>
                <div class="col-start-3 flex justify-end">
                    <div class="relative" id="language-dropdown-container">
                        <button id="language-toggle-btn" aria-haspopup="true" aria-expanded="false" class="flex items-center space-x-2 px-3 py-1.5 text-sm rounded-lg bg-neutral-900 border border-neutral-800 text-neutral-400 font-medium hover:bg-neutral-800 hover:text-white transition-all">
                            <span data-lang-key="language_label">Idioma</span>
                            <svg class="w-4 h-4 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div id="language-menu" class="hidden absolute right-0 mt-2 w-32 bg-neutral-900 border border-neutral-800 rounded-lg shadow-xl z-50 overflow-hidden" role="menu">
                            <a href="#" id="lang-es" class="block px-4 py-2.5 text-sm text-neutral-300 hover:bg-neutral-800 hover:text-white transition-colors" role="menuitem">Español</a>
                            <a href="#" id="lang-en" class="block px-4 py-2.5 text-sm text-neutral-300 hover:bg-neutral-800 hover:text-white transition-colors" role="menuitem">English</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main -->
    <main class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="max-w-6xl mx-auto">
            
            <!-- Upload Area -->
            <div id="upload-area" class="w-full border-2 border-dashed border-neutral-800 rounded-3xl p-8 md:p-20 text-center cursor-pointer hover:border-blue-500/40 hover:bg-neutral-900/30 transition-all duration-300 bg-neutral-900/10 mt-4 group">
                <input type="file" id="image-input" class="hidden" accept="image/*" multiple>
                <div class="flex flex-col items-center transform group-hover:scale-105 transition-transform duration-300">
                    <div class="p-5 rounded-2xl bg-neutral-900 border border-neutral-800 mb-5 group-hover:border-neutral-700 shadow-lg">
                        <svg class="w-12 h-12 text-neutral-500 group-hover:text-blue-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </div>
                    <p class="text-xl md:text-2xl font-semibold text-white mb-2" data-lang-key="upload_prompt_main">Arrastra tus imágenes</p>
                    <p class="text-sm md:text-base text-neutral-500" data-lang-key="upload_prompt_sub">o haz clic para explorar</p>
                </div>
            </div>

            <!-- Editor Container -->
            <div id="editor-container" class="hidden mt-6">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-8">
                    
                    <!-- Preview Column -->
                    <div id="preview-container" class="lg:col-span-7 xl:col-span-8 flex flex-col">
                        
                        <!-- COMPARISON SLIDER -->
                        <div id="editor-area" class="hidden bg-neutral-900 border border-neutral-800/60 p-1 rounded-3xl h-full min-h-[400px] relative select-none group overflow-hidden">
                            <div class="relative w-full h-full rounded-2xl overflow-hidden flex items-center justify-center bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAgMGgyMHYyMEgwVjB6IiBmaWxsPSIjMTcxNzE3IiAvPjxwYXRoIGQ9Ik0wIDBoMTB2MTBIMFYwek0xMCAxMGgxMHYxMEgxMFYxMHoiIGZpbGw9IiMyNjI2MjYiIGZpbGwtb3BhY2l0eT0iMC41IiAvPjwvc3ZnPg==')]">
                                <div class="relative w-full h-full max-h-[60vh] flex items-center justify-center" id="compare-wrapper">
                                    <!-- Original Image (Behind) -->
                                    <img id="image-original-bg" src="#" class="max-w-full max-h-full object-contain absolute" draggable="false" alt="Imagen original">
                                    <span class="absolute top-4 left-4 bg-black/60 text-white text-xs px-2 py-1 rounded backdrop-blur-sm z-0" data-lang-key="compare_original">Original</span>
                                    
                                    <!-- Optimized Image (Front - Clipped) -->
                                    <div id="image-optimized-container" class="absolute inset-0 w-full h-full flex items-center justify-center" style="clip-path: inset(0 50% 0 0);">
                                        <img id="image-preview" src="#" class="max-w-full max-h-full object-contain" draggable="false" alt="Imagen optimizada">
                                        <span class="absolute top-4 right-4 bg-blue-600/80 text-white text-xs px-2 py-1 rounded backdrop-blur-sm z-20" data-lang-key="compare_optimized">Optimizado</span>
                                    </div>

                                    <!-- Slider Handle -->
                                    <div id="compare-handle" class="absolute top-0 bottom-0 w-0.5 bg-white cursor-ew-resize z-30 shadow-[0_0_10px_rgba(0,0,0,0.5)]" style="left: 50%">
                                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-full p-1.5 shadow-lg text-neutral-900 hover:scale-110 transition-transform">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h8M8 17h8M12 7v10"></path></svg>
                                        </div>
                                    </div>
                                    
                                    <!-- Invisible Range Input for Interaction -->
                                    <input type="range" min="0" max="100" value="50" id="compare-range" class="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-40 m-0 p-0" aria-label="Comparar imágenes">
                                </div>
                            </div>

                            <!-- Stats Bar -->
                            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-4 bg-neutral-950/90 px-5 py-2.5 rounded-full backdrop-blur-md border border-neutral-800 shadow-xl z-20">
                                <p id="original-size" class="text-xs text-neutral-400 font-mono"></p>
                                <svg class="w-3 h-3 text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                <p id="new-size" class="text-sm font-bold font-mono transition-colors"></p>
                            </div>
                        </div>
                        
                        <!-- Batch Gallery -->
                        <div id="gallery-area" class="hidden h-full max-h-[65vh] overflow-y-auto bg-neutral-900 border border-neutral-800 p-4 rounded-3xl custom-scrollbar">
                            <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 xl:grid-cols-4 gap-4">
                                <!-- Thumbnails injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Controls Column -->
                    <div class="lg:col-span-5 xl:col-span-4 space-y-6">
                        <div class="bg-neutral-900 border border-neutral-800 p-6 rounded-3xl flex flex-col space-y-6 shadow-2xl h-full">
                            
                            <!-- Privacy Badge -->
                            <div class="flex items-center justify-center gap-2 bg-green-500/10 border border-green-500/20 rounded-lg p-2 mb-2">
                                <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span class="text-xs font-medium text-green-400" data-lang-key="privacy_badge">EXIF Limpio (Privacidad)</span>
                            </div>

                            <!-- Dimensions -->
                            <div id="dimensions-group">
                                <div class="flex justify-between items-center mb-3">
                                    <label class="text-xs font-bold text-neutral-400 uppercase tracking-widest" data-lang-key="dimensions_label">Dimensiones</label>
                                </div>
                                <div class="flex items-center gap-2">
                                    <div class="relative w-full">
                                        <input type="number" id="width-input" class="w-full bg-neutral-950 border border-neutral-800 rounded-lg px-3 py-3 text-center text-white font-mono text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all" placeholder="W" aria-label="Ancho">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-neutral-600 pointer-events-none">PX</span>
                                    </div>
                                    
                                    <button id="aspect-lock-btn" class="p-3 rounded-lg bg-neutral-800 hover:bg-neutral-700 text-neutral-400 hover:text-white transition-all border border-transparent hover:border-neutral-600" aria-label="Bloquear proporción">
                                        <!-- Icons matched -->
                                        <svg id="lock-icon" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path></svg>
                                        <svg id="unlock-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2V7a5 5 0 00-5-5zm3 11H7v-2h6v2zm0-4H7V7a3 3 0 016 0v2z" clip-rule="evenodd"/></svg>
                                    </button>
                                    
                                    <div class="relative w-full">
                                        <input type="number" id="height-input" class="w-full bg-neutral-950 border border-neutral-800 rounded-lg px-3 py-3 text-center text-white font-mono text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none transition-all" placeholder="H" aria-label="Alto">
                                        <span class="absolute right-3 top-1/2 -translate-y-1/2 text-[10px] text-neutral-600 pointer-events-none">PX</span>
                                    </div>
                                </div>
                                <div id="dimension-sliders" class="mt-4 space-y-3 px-1">
                                    <input type="range" id="width-slider" min="10" class="custom-range" aria-label="Ajustar ancho">
                                    <input type="range" id="height-slider" min="10" class="custom-range" aria-label="Ajustar alto">
                                </div>
                            </div>

                            <div class="h-px bg-neutral-800/50"></div>

                            <!-- Presets -->
                            <div>
                                <label class="block text-xs font-bold text-neutral-400 uppercase tracking-widest mb-3" data-lang-key="presets_label">Preajustes</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <button data-preset="web" class="preset-btn px-2 py-2 text-xs rounded-lg bg-neutral-800 border border-neutral-800 text-neutral-400 font-medium hover:bg-neutral-700 hover:text-white hover:border-neutral-600 transition-all" data-lang-key="preset_web">Blog/Web</button>
                                    <button data-preset="email" class="preset-btn px-2 py-2 text-xs rounded-lg bg-neutral-800 border border-neutral-800 text-neutral-400 font-medium hover:bg-neutral-700 hover:text-white hover:border-neutral-600 transition-all" data-lang-key="preset_email">Email</button>
                                    <button data-preset="social" class="preset-btn px-2 py-2 text-xs rounded-lg bg-neutral-800 border border-neutral-800 text-neutral-400 font-medium hover:bg-neutral-700 hover:text-white hover:border-neutral-600 transition-all" data-lang-key="preset_social">Social</button>
                                </div>
                            </div>
                            
                            <!-- Format -->
                            <div>
                                <label class="block text-xs font-bold text-neutral-400 uppercase tracking-widest mb-3" data-lang-key="format_label">Formato</label>
                                <div class="grid grid-cols-3 gap-2 bg-neutral-950 p-1 rounded-xl border border-neutral-800">
                                    <button data-format="jpeg" class="format-btn py-2 rounded-lg text-xs font-bold transition-all bg-neutral-800 text-white shadow-sm border border-neutral-700">JPEG</button>
                                    <button data-format="png" class="format-btn py-2 rounded-lg text-xs font-medium text-neutral-500 hover:text-white transition-all">PNG</button>
                                    <button data-format="webp" class="format-btn py-2 rounded-lg text-xs font-medium text-neutral-500 hover:text-white transition-all">WebP</button>
                                </div>
                            </div>

                            <!-- Quality -->
                            <div id="quality-control">
                                <div class="flex justify-between mb-3">
                                    <label class="text-xs font-bold text-neutral-400 uppercase tracking-widest" data-lang-key="quality_label">Calidad</label>
                                    <span class="text-xs font-mono text-blue-400 font-bold"><span id="quality-value">80</span>%</span>
                                </div>
                                <input type="range" id="quality" min="10" max="100" value="80" class="custom-range" aria-label="Ajustar calidad">
                            </div>
                            
                            <div class="flex-grow"></div>

                            <!-- Actions -->
                            <div class="pt-4 border-t border-neutral-800 space-y-3">
                                 <div class="flex gap-3">
                                    <button id="copy-btn" class="flex-1 bg-emerald-600 text-white font-bold py-3 px-2 rounded-xl hover:bg-emerald-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-emerald-900/20 group" disabled>
                                        <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                        <span class="text-xs sm:text-sm" data-lang-key="copy_button">Copiar</span>
                                    </button>
                                    <button id="download-btn" class="flex-[1.5] bg-blue-600 text-white font-bold py-3 px-2 rounded-xl hover:bg-blue-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-blue-900/20 group" disabled>
                                        <svg class="w-5 h-5 group-hover:translate-y-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                        <span class="text-xs sm:text-sm truncate" data-lang-key="download_button">Descargar</span>
                                    </button>
                                 </div>
                                 <!-- PDF Download Button -->
                                 <button id="download-pdf-btn" class="hidden w-full bg-red-600/90 text-white font-bold py-3 px-2 rounded-xl hover:bg-red-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-red-900/20 group" disabled>
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                    <span class="text-xs sm:text-sm" data-lang-key="download_pdf_button">Descargar todo (PDF)</span>
                                </button>

                                 <button id="reset-btn" class="w-full py-2 text-xs text-neutral-500 font-medium hover:text-neutral-300 transition-colors" data-lang-key="reset_button">
                                    Cargar otra imagen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div class="w-full flex justify-center items-center space-x-3 pb-6 px-4">
        <button id="privacy-btn" class="px-4 py-2 text-xs rounded-full bg-neutral-900 border border-neutral-800 text-neutral-500 font-medium hover:bg-neutral-800 hover:text-neutral-300 transition-all" data-lang-key="privacy_policy_title_short">Privacidad</button>
        <button id="instructions-btn" class="px-4 py-2 text-xs rounded-full bg-neutral-900 border border-neutral-800 text-neutral-500 font-medium hover:bg-neutral-800 hover:text-neutral-300 transition-all" data-lang-key="instructions_title_short">Instrucciones</button>
    </div>

    <footer class="w-full text-center p-6 border-t border-neutral-800/50 bg-neutral-950/50">
        <p class="text-neutral-600 text-xs">
            2026 <span data-lang-key="footer_rights">Todos los derechos reservados</span> • <a href="https://studio--hitsterai.us-central1.hosted.app/es" target="_blank" class="hover:text-blue-400 transition-colors">Hitster Ai</a> | 
            <a href="mailto:baez@hitster.page" class="text-blue-400 hover:text-blue-300 hover:underline transition-colors" data-lang-key="footer_contact">Contáctanos</a>
        </p>
    </footer>

    <!-- AEO & SEO: Structured Data (JSON-LD) for Software App + FAQ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "SoftwareApplication",
          "name": "Optimizador de Imágenes por Lotes",
          "operatingSystem": "Web Browser",
          "applicationCategory": "MultimediaApplication",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "description": "Herramienta gratuita y segura para comprimir, redimensionar y convertir imágenes a PDF en el navegador.",
          "featureList": "Compresión por lotes, conversión a PDF, eliminación de metadatos EXIF, procesamiento local.",
          "screenshot": "https://[TU-DOMINIO-FINAL.COM]/og-image.jpg",
           "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.9",
            "ratingCount": "1250"
          },
           "author": {
              "@type": "Organization",
              "name": "Hitster Ai",
              "url": "https://studio--hitsterai.us-central1.hosted.app/es"
           }
        },
        {
          "@type": "FAQPage",
          "mainEntity": [{
            "@type": "Question",
            "name": "¿Cómo comprimir imágenes sin perder calidad?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Utiliza nuestro optimizador de imágenes gratuito. Arrastra tus archivos JPG, PNG o WebP y ajusta el nivel de calidad con el deslizador para ver el resultado en tiempo real."
            }
          }, {
            "@type": "Question",
            "name": "¿Es seguro subir mis fotos a este optimizador?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Sí, totalmente. A diferencia de otros sitios, Hitster Ai procesa tus imágenes localmente en tu navegador. Tus archivos nunca se envían a ningún servidor."
            }
          }]
        }
      ]
    }
    </script>

    <script>
        // (Mismo código JS que la última versión funcional, sin cambios lógicos)
        const translations = {
            es: {
                title: "Optimizador de Imágenes v2.0",
                main_header: "Optimizador v2.0",
                upload_prompt_main: "Arrastra tus imágenes",
                upload_prompt_sub: "o haz clic para explorar",
                dimensions_label: "Dimensiones",
                width_placeholder: "Ancho",
                height_placeholder: "Alto",
                presets_label: "Preajustes",
                preset_web: "Blog/Web",
                preset_email: "Email",
                preset_social: "Social",
                format_label: "Formato",
                quality_label: "Calidad",
                download_button: "Descargar",
                download_all_button: "Descargar ZIP",
                download_pdf_button: "Descargar PDF",
                copy_button: "Copiar",
                reset_button: "Reiniciar",
                original_size_label: "Original:",
                new_size_label: "Nuevo:",
                footer_rights: "Derechos reservados",
                language_label: "Idioma",
                meta_description: "Optimiza, compara y convierte imágenes a PDF.",
                image_preview_alt: "Vista previa",
                copied_feedback: "¡Copiado!",
                copy_error_feedback: "Usa Descargar",
                privacy_badge: "EXIF Limpio",
                instructions_title: "Instrucciones",
                privacy_policy_title: "Privacidad",
                privacy_policy_title_short: "Privacidad",
                instructions_title_short: "Instrucciones",
                instructions_content: `<div class="text-neutral-400 space-y-4 text-justify text-sm"><p>Bienvenido a la v2.0. Arrastra imágenes, usa el slider para comparar calidad, y descarga en ZIP o PDF.</p></div>`,
                privacy_policy_content: `<div class="text-neutral-400 space-y-4 text-justify text-sm"><p>Sus imágenes se procesan localmente en su navegador. Los metadatos EXIF se eliminan automáticamente.</p></div>`,
                compare_original: "Original",
                compare_optimized: "Optimizado"
            },
            en: {
                title: "Image Optimizer v2.0",
                main_header: "Optimizer v2.0",
                upload_prompt_main: "Drag & drop images",
                upload_prompt_sub: "or click to browse",
                dimensions_label: "Dimensions",
                width_placeholder: "Width",
                height_placeholder: "Height",
                presets_label: "Presets",
                preset_web: "Blog/Web",
                preset_email: "Email",
                preset_social: "Social",
                format_label: "Format",
                quality_label: "Quality",
                download_button: "Download",
                download_all_button: "Download ZIP",
                download_pdf_button: "Download PDF",
                copy_button: "Copy",
                reset_button: "Reset",
                original_size_label: "Orig:",
                new_size_label: "New:",
                footer_rights: "All rights reserved",
                language_label: "Lang",
                meta_description: "Optimize, compare and convert images to PDF.",
                image_preview_alt: "Preview",
                copied_feedback: "Copied!",
                copy_error_feedback: "Use Download",
                privacy_badge: "Clean EXIF",
                instructions_title: "Instructions",
                privacy_policy_title: "Privacy",
                privacy_policy_title_short: "Privacy",
                instructions_title_short: "Instructions",
                instructions_content: `<div class="text-neutral-400 space-y-4 text-justify text-sm"><p>Welcome to v2.0. Drag images, use the slider to compare quality, and download as ZIP or PDF.</p></div>`,
                privacy_policy_content: `<div class="text-neutral-400 space-y-4 text-justify text-sm"><p>Your images are processed locally. EXIF metadata is stripped automatically.</p></div>`,
                compare_original: "Original",
                compare_optimized: "Optimized"
            }
        };
        
        // Restore long text
        translations.es.instructions_content = `
            <div class="text-neutral-400 space-y-4 text-justify text-sm">
                <h3 class="text-xl font-semibold text-white">Guía de Usuario: Optimizador v2.0</h3>
                <h4 class="text-lg font-semibold text-white pt-2">1. Carga</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Arrastra múltiples imágenes.</li>
                    <li>Pega desde portapapeles (Ctrl+V).</li>
                </ul>
                <h4 class="text-lg font-semibold text-white pt-2">2. Edición</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Usa el slider sobre la imagen para comparar Antes/Después.</li>
                    <li>Aplica preajustes rápidos.</li>
                </ul>
                <h4 class="text-lg font-semibold text-white pt-2">3. Exportar</h4>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Descarga individual o todo en ZIP.</li>
                    <li>Convierte lote a un solo PDF.</li>
                </ul>
            </div>`;
        translations.es.privacy_policy_content = `
            <div class="text-neutral-400 space-y-4 text-justify text-sm">
                <p><strong>Fecha:</strong> 23 de junio de 2025</p>
                <p>En Hitster Ai, tu privacidad es prioridad. El procesamiento es 100% local en tu dispositivo.</p>
                <h3 class="text-lg font-semibold text-white pt-2">Datos Personales</h3>
                <p>No recolectamos imágenes. Solo estadísticas de uso anónimas para mejorar el servicio.</p>
                <h3 class="text-lg font-semibold text-white pt-2">Seguridad</h3>
                <p>Tus fotos nunca salen de tu navegador. Los metadatos EXIF se limpian automáticamente.</p>
            </div>`;
        
        translations.en.instructions_content = `
            <div class="text-neutral-400 space-y-4 text-justify text-sm">
                <h3 class="text-xl font-semibold text-white">User Guide v2.0</h3>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Drag & drop multiple images.</li>
                    <li>Paste from clipboard.</li>
                    <li>Use slider to compare quality.</li>
                    <li>Download as ZIP or PDF.</li>
                </ul>
            </div>`;
        translations.en.privacy_policy_content = `
            <div class="text-neutral-400 space-y-4 text-justify text-sm">
                <p><strong>Date:</strong> June 23, 2025</p>
                <p>Processing is 100% local. Your images never leave your device.</p>
            </div>`;


        // --- Logic (Variables & Functions) ---
        let currentLang = null;
        let loadedImages = [];
        let isBatchMode = false;
        let originalImage = null; 
        let originalFileName = ''; 
        let originalFileSize = 0; 
        let outputFormat = 'jpeg';
        let aspectRatioLocked = true;
        
        const getEls = () => ({
            uploadArea: document.getElementById('upload-area'),
            imageInput: document.getElementById('image-input'),
            editorContainer: document.getElementById('editor-container'),
            editorArea: document.getElementById('editor-area'),
            galleryArea: document.getElementById('gallery-area'),
            galleryGrid: document.getElementById('gallery-grid'),
            imagePreview: document.getElementById('image-preview'), 
            imageOriginalBg: document.getElementById('image-original-bg'), 
            compareWrapper: document.getElementById('compare-wrapper'),
            compareRange: document.getElementById('compare-range'),
            imageOptimizedContainer: document.getElementById('image-optimized-container'),
            compareHandle: document.getElementById('compare-handle'),
            
            widthInput: document.getElementById('width-input'),
            heightInput: document.getElementById('height-input'),
            widthSlider: document.getElementById('width-slider'),
            heightSlider: document.getElementById('height-slider'),
            dimensionsGroup: document.getElementById('dimensions-group'),
            
            aspectLockBtn: document.getElementById('aspect-lock-btn'),
            lockIcon: document.getElementById('lock-icon'),
            unlockIcon: document.getElementById('unlock-icon'),
            
            formatButtons: document.querySelectorAll('.format-btn'),
            presetButtons: document.querySelectorAll('.preset-btn'),
            
            qualityControl: document.getElementById('quality-control'),
            qualitySlider: document.getElementById('quality'),
            qualityValue: document.getElementById('quality-value'),
            
            downloadBtn: document.getElementById('download-btn'),
            downloadPdfBtn: document.getElementById('download-pdf-btn'),
            copyBtn: document.getElementById('copy-btn'),
            resetBtn: document.getElementById('reset-btn'),
            
            originalSizeDisplay: document.getElementById('original-size'),
            newSizeDisplay: document.getElementById('new-size'),
            copyFeedback: document.getElementById('copy-feedback'),
            errorFeedback: document.getElementById('error-feedback'),
            errorMessage: document.getElementById('error-message'),
            
            instructionsBtns: document.querySelectorAll('#instructions-btn'),
            privacyBtns: document.querySelectorAll('#privacy-btn'),
            instructionsModal: document.getElementById('instructions-modal'),
            closeInstructionsModalBtn: document.getElementById('close-instructions-modal-btn'),
            privacyModal: document.getElementById('privacy-modal'),
            closePrivacyModalBtn: document.getElementById('close-privacy-modal-btn'),
            
            langToggle: document.getElementById('language-toggle-btn'),
            langMenu: document.getElementById('language-menu'),
            langContainer: document.getElementById('language-dropdown-container'),
            langEs: document.getElementById('lang-es'),
            langEn: document.getElementById('lang-en')
        });

        const setLanguage = (lang) => {
            if (lang === currentLang) return;
            currentLang = lang;
            document.documentElement.lang = lang;
            
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                const txt = translations[lang][key];
                if(!txt) return;
                
                if(key === 'title') document.title = txt;
                else if(key.endsWith('_content')) el.innerHTML = txt;
                else {
                    const icon = el.querySelector('svg');
                    if(icon) {
                        Array.from(el.childNodes).forEach(c => { if(c.nodeType === Node.TEXT_NODE) el.removeChild(c); });
                        el.appendChild(document.createTextNode(` ${txt}`));
                    } else {
                        el.textContent = txt;
                    }
                }
            });
            
            if(originalImage || isBatchMode) updateDisplays();
        };

        const formatBytes = (bytes, decimals = 2) => {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        };

        const handleFiles = (files) => {
            if (files.length === 0) return;
            isBatchMode = files.length > 1;
            const els = getEls();
            
            if (!isBatchMode) {
                const file = files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        originalFileName = file.name;
                        originalFileSize = file.size;
                        
                        els.imagePreview.src = img.src;
                        els.imageOriginalBg.src = img.src;
                        
                        els.widthInput.value = img.width;
                        els.heightInput.value = img.height;
                        els.widthSlider.max = img.width * 2;
                        els.widthSlider.value = img.width;
                        els.heightSlider.max = img.height * 2;
                        els.heightSlider.value = img.height;

                        els.uploadArea.classList.add('hidden');
                        els.editorContainer.classList.remove('hidden');
                        els.editorArea.style.display = 'flex';
                        els.galleryArea.style.display = 'none';
                        els.dimensionsGroup.style.display = 'block';
                        els.copyBtn.style.display = 'flex';
                        els.downloadPdfBtn.style.display = 'none';

                        els.copyBtn.disabled = false;
                        els.downloadBtn.disabled = false;
                        
                        updateDisplays();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                loadedImages = [];
                els.galleryGrid.innerHTML = '';
                let processed = 0;
                
                Array.from(files).forEach((file, idx) => {
                     const reader = new FileReader();
                     reader.onload = (e) => {
                         const img = new Image();
                         img.onload = () => {
                             loadedImages.push({ file, img, newSize: 0 });
                             
                             const div = document.createElement('div');
                             div.className = 'relative group bg-neutral-800 rounded-xl overflow-hidden border border-neutral-700';
                             div.innerHTML = `
                                <img src="${img.src}" class="w-full h-32 object-cover">
                                <div class="absolute inset-0 bg-black/60 flex flex-col items-center justify-center p-2">
                                    <p class="text-[10px] text-neutral-400">${translations[currentLang].original_size_label} ${formatBytes(file.size)}</p>
                                    <p class="text-xs font-bold text-green-400" id="batch-size-${idx}">...</p>
                                </div>
                             `;
                             els.galleryGrid.appendChild(div);
                             
                             processed++;
                             if(processed === files.length) updateDisplays();
                         };
                         img.src = e.target.result;
                     };
                     reader.readAsDataURL(file);
                });

                els.uploadArea.classList.add('hidden');
                els.editorContainer.classList.remove('hidden');
                els.editorArea.style.display = 'none';
                els.galleryArea.style.display = 'block';
                els.dimensionsGroup.style.display = 'none'; 
                els.copyBtn.style.display = 'none'; 
                els.downloadPdfBtn.style.display = 'flex';
                els.downloadPdfBtn.disabled = false;
                els.downloadBtn.disabled = false;
            }
        };

        const getOptimizedBlob = (img, w, h) => {
             return new Promise(resolve => {
                 const els = getEls();
                 const q = parseInt(els.qualitySlider.value) / 100;
                 const cvs = document.createElement('canvas');
                 cvs.width = w;
                 cvs.height = h;
                 cvs.getContext('2d').drawImage(img, 0, 0, w, h);
                 cvs.toBlob(blob => resolve(blob), `image/${outputFormat}`, q);
             });
        };

        const updateDisplays = async () => {
            const els = getEls();
            const q = parseInt(els.qualitySlider.value);
            
            const dlBtnText = isBatchMode ? translations[currentLang].download_all_button : translations[currentLang].download_button;
            els.downloadBtn.querySelector('span').textContent = dlBtnText;

            if(!isBatchMode && originalImage) {
                const w = parseInt(els.widthInput.value);
                const h = parseInt(els.heightInput.value);
                const blob = await getOptimizedBlob(originalImage, w, h);
                if(blob) {
                     const url = URL.createObjectURL(blob);
                     els.imagePreview.src = url; 
                     
                     els.originalSizeDisplay.textContent = `${translations[currentLang].original_size_label} ${formatBytes(originalFileSize)}`;
                     els.newSizeDisplay.textContent = `${translations[currentLang].new_size_label} ${formatBytes(blob.size)}`;
                     
                     if (blob.size > originalFileSize) {
                         els.newSizeDisplay.classList.remove('text-green-400');
                         els.newSizeDisplay.classList.add('text-red-500');
                     } else {
                         els.newSizeDisplay.classList.remove('text-red-500');
                         els.newSizeDisplay.classList.add('text-green-400');
                     }
                }
            } else if (isBatchMode) {
                 loadedImages.forEach(async (item, idx) => {
                     const blob = await getOptimizedBlob(item.img, item.img.width, item.img.height); 
                     if(blob) {
                        const p = document.getElementById(`batch-size-${idx}`);
                        if(p) {
                            p.textContent = formatBytes(blob.size);
                             if (blob.size > item.file.size) {
                                 p.classList.remove('text-green-400');
                                 p.classList.add('text-red-500');
                             } else {
                                 p.classList.remove('text-red-500');
                                 p.classList.add('text-green-400');
                             }
                        }
                     }
                 });
            }
        };

        const els = getEls();
        if(els.compareRange) {
            els.compareRange.addEventListener('input', (e) => {
                const val = e.target.value;
                els.imageOptimizedContainer.style.clipPath = `inset(0 ${100 - val}% 0 0)`;
                els.compareHandle.style.left = `${val}%`;
            });
        }

        const init = () => {
            const elements = getEls();
            
            elements.langEs.onclick = (e) => { e.preventDefault(); setLanguage('es'); elements.langMenu.classList.add('hidden'); };
            elements.langEn.onclick = (e) => { e.preventDefault(); setLanguage('en'); elements.langMenu.classList.add('hidden'); };
            elements.langToggle.onclick = (e) => { e.stopPropagation(); elements.langMenu.classList.toggle('hidden'); };
            document.onclick = (e) => { if(!elements.langContainer.contains(e.target)) elements.langMenu.classList.add('hidden'); };

            elements.uploadArea.onclick = () => elements.imageInput.click();
            elements.uploadArea.ondragover = (e) => { e.preventDefault(); elements.uploadArea.classList.add('border-blue-500'); };
            elements.uploadArea.ondragleave = () => elements.uploadArea.classList.remove('border-blue-500');
            elements.uploadArea.ondrop = (e) => { e.preventDefault(); handleFiles(e.dataTransfer.files); };
            elements.imageInput.onchange = (e) => handleFiles(e.target.files);

            const sync = (val, isW) => {
                if(!originalImage) return;
                const ratio = originalImage.width / originalImage.height;
                if(aspectRatioLocked) {
                    if(isW) {
                        elements.heightInput.value = Math.round(val / ratio);
                        elements.heightSlider.value = Math.round(val / ratio);
                    } else {
                        elements.widthInput.value = Math.round(val * ratio);
                        elements.widthSlider.value = Math.round(val * ratio);
                    }
                }
                updateDisplays();
            };
            
            elements.widthInput.oninput = (e) => sync(e.target.value, true);
            elements.widthSlider.oninput = (e) => { elements.widthInput.value = e.target.value; sync(e.target.value, true); };
            
            elements.heightInput.oninput = (e) => sync(e.target.value, false);
            elements.heightSlider.oninput = (e) => { elements.heightInput.value = e.target.value; sync(e.target.value, false); };

            elements.aspectLockBtn.onclick = () => {
                aspectRatioLocked = !aspectRatioLocked;
                elements.lockIcon.classList.toggle('hidden');
                elements.unlockIcon.classList.toggle('hidden');
            };
            
            elements.qualitySlider.oninput = (e) => {
                elements.qualityValue.textContent = e.target.value;
                updateDisplays();
            };

            elements.formatButtons.forEach(btn => {
                btn.onclick = () => {
                    outputFormat = btn.dataset.format;
                    elements.formatButtons.forEach(b => {
                        b.classList.remove('bg-neutral-600', 'text-white', 'shadow-sm', 'border', 'border-neutral-700');
                        b.classList.add('text-neutral-500');
                    });
                    btn.classList.add('bg-neutral-600', 'text-white', 'shadow-sm', 'border', 'border-neutral-700');
                    btn.classList.remove('text-neutral-500');
                    
                    elements.qualityControl.style.display = outputFormat === 'png' ? 'none' : 'block';
                    updateDisplays();
                };
            });
            
            elements.presetButtons.forEach(btn => {
                btn.onclick = () => {
                    if (!originalImage) return;
                    elements.presetButtons.forEach(p => p.classList.remove('bg-neutral-600', 'text-white'));
                    btn.classList.add('bg-neutral-600', 'text-white');

                    const preset = btn.dataset.preset;
                    let targetW = originalImage.width;
                    
                    if(preset === 'web') { 
                        outputFormat = 'webp'; targetW = Math.min(1200, originalImage.width); 
                        elements.qualitySlider.value = 80; 
                    } else if(preset === 'email') {
                        outputFormat = 'jpeg'; targetW = Math.round(originalImage.width * 0.5);
                        elements.qualitySlider.value = 70;
                    } else {
                        outputFormat = 'jpeg'; targetW = Math.min(1080, originalImage.width);
                        elements.qualitySlider.value = 85;
                    }
                    
                    document.querySelector(`button[data-format="${outputFormat}"]`).click();
                    
                    elements.widthInput.value = targetW;
                    sync(targetW, true);
                    elements.widthSlider.value = targetW;
                };
            });

            elements.downloadPdfBtn.onclick = async () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                for (let i = 0; i < loadedImages.length; i++) {
                    const item = loadedImages[i];
                    const blob = await getOptimizedBlob(item.img, item.img.width, item.img.height);
                    const url = URL.createObjectURL(blob);
                    
                    const props = doc.getImageProperties(url);
                    const pdfWidth = doc.internal.pageSize.getWidth();
                    const pdfHeight = (props.height * pdfWidth) / props.width;
                    
                    if (i > 0) doc.addPage();
                    doc.addImage(url, outputFormat.toUpperCase(), 0, 0, pdfWidth, pdfHeight);
                }
                doc.save("optimized-images.pdf");
            };
            
            elements.downloadBtn.onclick = async () => {
                if(isBatchMode) {
                     const zip = new JSZip();
                     for (const item of loadedImages) {
                         const blob = await getOptimizedBlob(item.img, item.img.width, item.img.height);
                         zip.file(`${item.file.name.split('.')[0]}_opt.${outputFormat}`, blob);
                     }
                     zip.generateAsync({type:"blob"}).then(c => {
                         const a = document.createElement('a'); a.href = URL.createObjectURL(c); a.download = "images.zip"; a.click();
                     });
                } else {
                    const w = parseInt(elements.widthInput.value);
                    const h = parseInt(elements.heightInput.value);
                    const blob = await getOptimizedBlob(originalImage, w, h);
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `image_opt.${outputFormat}`; a.click();
                }
            };

            elements.copyBtn.onclick = async () => {
                const w = parseInt(elements.widthInput.value);
                const h = parseInt(elements.heightInput.value);
                const blob = await getOptimizedBlob(originalImage, w, h);
                
                if (!blob) return;

                if (navigator.clipboard && navigator.clipboard.write) {
                    try {
                        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
                        elements.copyFeedback.classList.remove('opacity-0', 'translate-y-2');
                        setTimeout(() => elements.copyFeedback.classList.add('opacity-0', 'translate-y-2'), 2000);
                        return;
                    } catch (err) {
                        console.warn('Clipboard API failed, trying fallback');
                    }
                }
                
                elements.errorFeedback.classList.remove('opacity-0', 'translate-y-2');
                document.getElementById('error-message').textContent = translations[currentLang].copy_error_feedback;
                setTimeout(() => elements.errorFeedback.classList.add('opacity-0', 'translate-y-2'), 3000);
            };

            elements.resetBtn.onclick = () => location.reload();
            
            const toggleModal = (modal, show) => modal.classList.toggle('hidden', !show);
            elements.instructionsBtns.forEach(b => b.onclick = () => toggleModal(elements.instructionsModal, true));
            elements.closeInstructionsModalBtn.onclick = () => toggleModal(elements.instructionsModal, false);
            elements.privacyBtns.forEach(b => b.onclick = () => toggleModal(elements.privacyModal, true));
            elements.closePrivacyModalBtn.onclick = () => toggleModal(elements.privacyModal, false);

            setLanguage('es');
        };

        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
